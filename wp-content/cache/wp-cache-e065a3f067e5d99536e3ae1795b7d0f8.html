<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>【Android课堂】在桌面添加可拖动/可点击的悬浮窗口 | Kris on Mobile Development</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://www.krislq.com/wp-content/themes/Zine/style.css" />
<link rel="shortcut icon" href="http://www.krislq.com/favicon.ico" />
<link rel="pingback" href="http://www.krislq.com/xmlrpc.php" />

	<style type="text/css">
		#fancybox-close{right:-15px;top:-15px}
		div#fancybox-content{border-color:#FFFFFF}
		div#fancybox-title{background-color:#FFFFFF}
		div#fancybox-outer{background-color:#FFFFFF}
		div#fancybox-title-inside{color:#333333}
	</style>

	<link rel="alternate" type="application/rss+xml" title="Kris on Mobile Development &raquo; Feed" href="http://www.krislq.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Kris on Mobile Development &raquo; 评论Feed" href="http://www.krislq.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Kris on Mobile Development &raquo; 【Android课堂】在桌面添加可拖动/可点击的悬浮窗口评论Feed" href="http://www.krislq.com/2012/11/android_class_floating_window/feed/" />
<link rel='stylesheet' id='fancybox-css'  href='http://www.krislq.com/wp-content/plugins/fancybox-for-wordpress/fancybox/fancybox.css?ver=4.0' type='text/css' media='all' />
<link rel='stylesheet' id='wp-pagenavi-css'  href='http://www.krislq.com/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<script type="text/javascript">
var duoshuoQuery = {"short_name":"krislq","sso":{"login":"http:\/\/www.krislq.com\/wp-login.php?action=duoshuo_login","logout":"http:\/\/www.krislq.com\/wp-login.php?action=logout&_wpnonce=5750617ac4"},"theme":"default","stylePatch":"wordpress\/Zine"};
duoshuoQuery.sso.login += '&redirect_to=' + encodeURIComponent(window.location.href);
duoshuoQuery.sso.logout += '&redirect_to=' + encodeURIComponent(window.location.href);
</script>
<script type="text/javascript" src="http://static.duoshuo.com/embed.js" charset="UTF-8" async="async"></script>
<script type='text/javascript' src='http://www.krislq.com/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script type='text/javascript' src='http://www.krislq.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://www.krislq.com/wp-content/plugins/fancybox-for-wordpress/fancybox/jquery.fancybox.js?ver=1.3.4'></script>
<script type='text/javascript' src='http://www.krislq.com/wp-content/plugins/fancybox-for-wordpress/js/jquery.easing.1.3.min.js?ver=1.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.krislq.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.krislq.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='【Android课堂】判断当前显示是否为桌面' href='http://www.krislq.com/2012/11/android_class_judge_whether_it_is_launcher/' />
<link rel='next' title='Android课堂-在桌面添加可拖动/可点击的悬浮窗口(续)' href='http://www.krislq.com/2012/11/android_class_floating_window2/' />
<meta name="generator" content="WordPress 4.0" />
<link rel='canonical' href='http://www.krislq.com/2012/11/android_class_floating_window/' />
<link rel='shortlink' href='http://www.krislq.com/?p=325' />

<!-- Fancybox for WordPress v3.0.2 -->
<script type="text/javascript">
jQuery(function(){

jQuery.fn.getTitle = function() { // Copy the title of every IMG tag and add it to its parent A so that fancybox can show titles
	var arr = jQuery("a.fancybox");
	jQuery.each(arr, function() {
		var title = jQuery(this).children("img").attr("title");
		jQuery(this).attr('title',title);
	})
}

// Supported file extensions
var thumbnails = jQuery("a:has(img)").not(".nolightbox").filter( function() { return /\.(jpe?g|png|gif|bmp)$/i.test(jQuery(this).attr('href')) });

thumbnails.addClass("fancybox").attr("rel","fancybox").getTitle();
jQuery("a.fancybox").fancybox({
	'cyclic': false,
	'autoScale': true,
	'padding': 10,
	'opacity': true,
	'speedIn': 500,
	'speedOut': 500,
	'changeSpeed': 300,
	'overlayShow': true,
	'overlayOpacity': "0.3",
	'overlayColor': "#666666",
	'titleShow': true,
	'titlePosition': 'inside',
	'enableEscapeButton': true,
	'showCloseButton': true,
	'showNavArrows': true,
	'hideOnOverlayClick': true,
	'hideOnContentClick': false,
	'width': 560,
	'height': 340,
	'transitionIn': "elastic",
	'transitionOut': "elastic",
	'centerOnScroll': true,
	'easingIn': "easeOutBack",
	'easingOut': "easeInBack",
	'easingChange': "easeInOutQuart"
});


})
</script>
<!-- END Fancybox for WordPress -->
<link rel="stylesheet" type="text/css" href="http://www.krislq.com/wp-content/plugins/wp-code-highlight/css/wp-code-highlight.css" media="screen" />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<script type="text/javascript" src="http://www.krislq.com/wp-content/themes/Zine/comments-ajax.js"></script><style>
.post, .page .page,.commentlist li.depth-1,h4.widget-title,#author,#email,#url,#comment{background-color:rgba(255,255,255,.9)}
#toolbar{opacity:.9}
#comments h3, #related_posts h3 ,#comments h3 span, #related_posts h3 span{background:none}
#header,#nav,#footer{border-color:rgba(255,255,255,.8)}
#nav,#footer{-webkit-box-shadow:0 0 12px rgba(0,0,0,.2);-moz-box-shadow:0 0 12px rgba(0,0,0,.2);box-shadow:0 0 12px rgba(0,0,0,.2)}
#sidebar .widget_categories li{width:95px;float:left}#sidebar .widget_links li{width:95px;float:left}</style>
</head>

<body class="single single-post postid-325 single-format-standard">
<div id="header" role="banner">
	<div id="masthead">
		<div id="branding">
			<div id="logo">
				<a href="http://www.krislq.com/" title="Kris on Mobile Development" rel="home"><img alt="Kris on Mobile Development" src="http://www.krislq.com/wp-content/themes/Zine/images/logo.png" />Kris on Mobile Development</a>
			</div>
			<div id="site-description">专注移动互联，提供移动开发、培训与解决方案。</div>
		</div>
		<div id="toolbar">
			<ul>
				<li class="search">
					<form role="search" method="get" id="searchform" action="http://www.krislq.com/">
						<input type="text" value="搜索" name="s" id="s" />
						<input type="submit" id="searchsubmit" value="搜索" />
					</form>
				</li>
				<li class="rss"><a href="http://list.qq.com/cgi-bin/qf_invite?id=abae06cf8d9c8c31083db02b4068309aae7c804724ea3ad1" target="_blank">订阅</a></li>
								<li class="mblog mblog_sina"><a href="http://www.weibo.com/kris008" target="_blank">微博</a></li>
			</ul>
		</div>
	</div>
	<div id="nav" role="navigation">
		<div id="menu-container" class="menu-%e5%af%bc%e8%88%aa-container"><ul id="menu-%e5%af%bc%e8%88%aa" class="menu"><li id="menu-item-465" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-465"><a href="http://www.krislq.com/"><span>首页</span><span class="desc">INDEX</span></a></li>
<li id="menu-item-43" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-43"><a href="http://www.krislq.com/project/"><span>项目</span><span class="desc">PROJECTS</span></a></li>
<li id="menu-item-607" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-607"><a href="http://www.krislq.com/tools/"><span>工具</span><span class="desc">TOOLS</span></a></li>
<li id="menu-item-42" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-42"><a href="http://www.krislq.com/book/"><span>书籍</span><span class="desc">BOOKS</span></a></li>
<li id="menu-item-41" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-41"><a href="http://www.krislq.com/travel/"><span>旅行</span><span class="desc">TRAVEL</span></a></li>
<li id="menu-item-12" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-12"><a href="http://www.krislq.com/archive/"><span>归档</span><span class="desc">ARCHIVES</span></a></li>
<li id="menu-item-13" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-13"><a href="http://www.krislq.com/about/"><span>关于</span><span class="desc">ABOUT</span></a></li>
<li id="menu-item-19" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-19"><a href="http://www.krislq.com/wall/"><span>留言墙</span><span class="desc">WALL</span></a></li>
</ul></div>	</div>
</div>

<div id="main">	<div id="content" role="main">
		<div id="post-325" class="post-325 post type-post status-publish format-standard hentry category-android category-class category-development category-case tag-360 tag-121 tag-118 tag-122 tag-119 tag-114 tag-123 tag-124 tag-120">
			<h1 class="entry-title"><a href="http://www.krislq.com/2012/11/android_class_floating_window/" title="链向 【Android课堂】在桌面添加可拖动/可点击的悬浮窗口 的固定链接" rel="bookmark">【Android课堂】在桌面添加可拖动/可点击的悬浮窗口</a></h1>
			<div class="entry-meta">
				<span class="entry-date"><span class="entry-month">2012-11</span><span class="sl">-</span><span class="entry-day">29</span></span>
				分类：<a href="http://www.krislq.com/category/development/android/" rel="category tag">Android</a>, <a href="http://www.krislq.com/category/development/class/" rel="category tag">学习课堂</a>, <a href="http://www.krislq.com/category/development/" rel="category tag">开发</a>, <a href="http://www.krislq.com/category/development/case/" rel="category tag">随手实例</a> | 
				标签：<a href="http://www.krislq.com/tag/360/" rel="tag">360</a>, <a href="http://www.krislq.com/tag/%e5%88%b7%e6%96%b0/" rel="tag">刷新</a>, <a href="http://www.krislq.com/tag/%e6%82%ac%e6%b5%ae%e7%aa%97/" rel="tag">悬浮窗</a>, <a href="http://www.krislq.com/tag/%e6%8b%96%e5%8a%a8/" rel="tag">拖动</a>, <a href="http://www.krislq.com/tag/%e6%95%88%e6%9e%9c%e5%9b%be/" rel="tag">效果图</a>, <a href="http://www.krislq.com/tag/%e6%a1%8c%e9%9d%a2/" rel="tag">桌面</a>, <a href="http://www.krislq.com/tag/%e7%82%b9%e5%87%bb/" rel="tag">点击</a>, <a href="http://www.krislq.com/tag/%e7%8a%b6%e6%80%81%e6%a0%8f/" rel="tag">状态栏</a>, <a href="http://www.krislq.com/tag/%e8%a7%a6%e6%91%b8/" rel="tag">触摸</a> | 				<span class="comments-link"><a href="http://www.krislq.com/2012/11/android_class_floating_window/#comments" class="ds-thread-count" data-thread-key="325" title="《【Android课堂】在桌面添加可拖动/可点击的悬浮窗口》上的评论">3条评论</a></span>
											</div>
			<div class="entry-content">
				<p>&nbsp;&nbsp;&nbsp;&nbsp;用过新版本android 360手机助手都人都对 360中只在桌面显示一个小小悬浮窗口羡慕不已吧？<br />
&nbsp;&nbsp;&nbsp;&nbsp;其实实现这种功能，主要有<strong>两步</strong>：<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.判断当前显示的是为桌面。这个内容我在前面的帖子里面已经有过介绍，如果还没看过的赶快稳步看一下哦。<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.krislq.com/2012/11/android_class_judge_whether_it_is_launcher/" title="Android课堂-判断当前显示是否为桌面" target="_blank">Android课堂-判断当前显示是否为桌面</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.使用windowManager往最顶层添加一个View .这个知识点就是为本文主要讲解的内容哦。在本文的讲解中，我们还会讲到下面的知识点：<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a.如果获取到状态栏的高度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.悬浮窗口的拖动<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.悬浮窗口的点击事件<br />
<span id="more-325"></span><br />
&nbsp;&nbsp;&nbsp;&nbsp;有开始之前，我们先来看一下效果图：<br />
<img class="size-medium wp-image-326 aligncenter" title="float_window" src="http://www.krislq.com/wp-content/uploads/2012/11/float_window-147x300.jpg" alt="" width="147" height="300" /><br />
&nbsp;&nbsp;&nbsp;&nbsp;接下来我们来看看FloatView的代码：</p>
<pre class="wp-code-highlight prettyprint linenums:1">
/**
 * 
 * @author &lt;a href=&quot;mailto:kris@krislq.com&quot;&gt;Kris.lee&lt;/a&gt;
 * @website www.krislq.com
 * @date Nov 29, 2012
 * @version 1.0.0
 *
 */
public class FloatView extends ImageView{
	private float mTouchX;
	private float mTouchY;
	private float x;
	private float y;
	private float mStartX;
	private float mStartY;
	private OnClickListener mClickListener;

	private WindowManager windowManager = (WindowManager) getContext()
			.getApplicationContext().getSystemService(Context.WINDOW_SERVICE);
	// 此windowManagerParams变量为获取的全局变量，用以保存悬浮窗口的属性
	private WindowManager.LayoutParams windowManagerParams = ((FloatApplication) getContext()
			.getApplicationContext()).getWindowParams();

	public FloatView(Context context) {
		super(context);
	}

	@Override
	public boolean onTouchEvent(MotionEvent event) {
		//获取到状态栏的高度
		Rect frame =  new  Rect();  
		getWindowVisibleDisplayFrame(frame);
		int  statusBarHeight = frame.top; 
		System.out.println(&quot;statusBarHeight:&quot;+statusBarHeight);
		// 获取相对屏幕的坐标，即以屏幕左上角为原点
		x = event.getRawX();
		y = event.getRawY() - statusBarHeight; // statusBarHeight是系统状态栏的高度
		Log.i(&quot;tag&quot;, &quot;currX&quot; + x + &quot;====currY&quot; + y);
		switch (event.getAction()) {
		case MotionEvent.ACTION_DOWN: // 捕获手指触摸按下动作
			// 获取相对View的坐标，即以此View左上角为原点
			mTouchX = event.getX();
			mTouchY = event.getY();
			mStartX = x;
			mStartY = y;
			Log.i(&quot;tag&quot;, &quot;startX&quot; + mTouchX + &quot;====startY&quot;
					+ mTouchY);
			break;

		case MotionEvent.ACTION_MOVE: // 捕获手指触摸移动动作
			updateViewPosition();
			break;

		case MotionEvent.ACTION_UP: // 捕获手指触摸离开动作
			updateViewPosition();
			mTouchX = mTouchY = 0;
			if ((x - mStartX) &lt; 5 &amp;&amp; (y - mStartY) &lt; 5) {
				if(mClickListener!=null) {
					mClickListener.onClick(this);
				}
			}
			break;
		}
		return true;
	}
	@Override
	public void setOnClickListener(OnClickListener l) {
		this.mClickListener = l;
	}
	private void updateViewPosition() {
		// 更新浮动窗口位置参数
		windowManagerParams.x = (int) (x - mTouchX);
		windowManagerParams.y = (int) (y - mTouchY);
		windowManager.updateViewLayout(this, windowManagerParams); // 刷新显示
	}
}</pre>
<p><strong>代码解释：</strong></p>
<pre class="wp-code-highlight prettyprint linenums:1">
 int  statusBarHeight = frame.top; </pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;为获取状态栏的高度，为什么在event.getRawY()的时候减去状态栏的高度呢？<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为我们的悬浮窗口不可能显示到状态栏中去，而后getRawY为获取到屏幕原点的距离。当我们屏幕处于全屏模式时，获取到的状态栏高度会变成0 .</p>
<pre class="wp-code-highlight prettyprint linenums:1">
(x - mStartX) &lt; 5 &amp;&amp; (y - mStartY) &lt; 5</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;如果我们在触摸过程中，移动距离少于5 ,则视为点击，触发点击的回调。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;另外我们需要自定义一个application:</p>
<pre class="wp-code-highlight prettyprint linenums:1">
/**
 * 
 * @author &lt;a href=&quot;mailto:kris@krislq.com&quot;&gt;Kris.lee&lt;/a&gt;
 * @website www.krislq.com
 * @date Nov 29, 2012
 * @version 1.0.0
 *
 */
public class FloatApplication extends Application {
	private WindowManager.LayoutParams windowParams = new WindowManager.LayoutParams();

	public WindowManager.LayoutParams getWindowParams() {
		return windowParams;
	}
}</pre>
<p><strong>代码解释：</strong><br />
&nbsp;&nbsp;&nbsp;&nbsp;自定义application的目的是为了保存windowParams的值 ，因为我们在拖动悬浮窗口的时候，如果每次都重新new一个layoutParams的话，在update 的时候会在异常发现。<br />
&nbsp;&nbsp;&nbsp;&nbsp;windowParams的值也不一定非得在自定义application里面来保存，只要是全局的都行。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;最后我们再来看看Activity中的实现。</p>
<pre class="wp-code-highlight prettyprint linenums:1">
/**
 * 
 * @author &lt;a href=&quot;mailto:kris@krislq.com&quot;&gt;Kris.lee&lt;/a&gt;
 * @website www.krislq.com
 * @date Nov 29, 2012
 * @version 1.0.0
 *
 */
public class MainActivity extends Activity  implements OnClickListener{
	private WindowManager windowManager = null;
	private WindowManager.LayoutParams windowManagerParams = null;
	private FloatView floatView = null;

	@Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);//取消标题栏
        getWindow().setFlags(WindowManager.LayoutParams. FLAG_FULLSCREEN ,
                      WindowManager.LayoutParams. FLAG_FULLSCREEN);//全屏
        setContentView(R.layout.activity_main);
       	createView(); 
    }

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		getMenuInflater().inflate(R.menu.activity_main, menu);
		return true;
	}

	public void onDestroy() {
		super.onDestroy();
		// 在程序退出(Activity销毁）时销毁悬浮窗口
		windowManager.removeView(floatView);
	}

	private void createView() {
		floatView = new FloatView(getApplicationContext());
		floatView.setOnClickListener(this);
		floatView.setImageResource(R.drawable.ic_launcher); // 这里简单的用自带的icon来做演示
		// 获取WindowManager
		windowManager = (WindowManager) getApplicationContext().getSystemService(Context.WINDOW_SERVICE);
		// 设置LayoutParams(全局变量）相关参数
		windowManagerParams = ((FloatApplication) getApplication()).getWindowParams();

		windowManagerParams.type = LayoutParams.TYPE_PHONE; // 设置window type
		windowManagerParams.format = PixelFormat.RGBA_8888; // 设置图片格式，效果为背景透明
		// 设置Window flag
		windowManagerParams.flags = LayoutParams.FLAG_NOT_TOUCH_MODAL
				| LayoutParams.FLAG_NOT_FOCUSABLE;
		/*
		 * 注意，flag的值可以为：
		 * LayoutParams.FLAG_NOT_TOUCH_MODAL 不影响后面的事件
		 * LayoutParams.FLAG_NOT_FOCUSABLE  不可聚焦
		 * LayoutParams.FLAG_NOT_TOUCHABLE 不可触摸
		 */
		// 调整悬浮窗口至左上角，便于调整坐标
		windowManagerParams.gravity = Gravity.LEFT | Gravity.TOP; 
		// 以屏幕左上角为原点，设置x、y初始值
		windowManagerParams.x = 0;
		windowManagerParams.y = 0;
		// 设置悬浮窗口长宽数据
		windowManagerParams.width = LayoutParams.WRAP_CONTENT;
		windowManagerParams.height = LayoutParams.WRAP_CONTENT;
		// 显示myFloatView图像
		windowManager.addView(floatView, windowManagerParams);
	}

	public void onClick(View v) {
		Toast.makeText(this, &quot;Clicked&quot;, Toast.LENGTH_SHORT).show();
	}
}</pre>
<p><strong>代码解释：</strong><br />
&nbsp;&nbsp;&nbsp;&nbsp;在activity中我们主要是添加悬浮窗，并且设置他的位置。另外需要注意flags的应用：<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LayoutParams.FLAG_NOT_TOUCH_MODAL 不影响后面的事件<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LayoutParams.FLAG_NOT_FOCUSABLE 不可聚焦<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LayoutParams.FLAG_NOT_TOUCHABLE 不可触摸</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;最后我们在onDestroy()中移除到悬浮窗口。所以，我们测试的时候，记得按Home键来切换到桌面。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;最后千万记得，在androidManifest.xml中来申明我们需要用到的android.permission.SYSTEM_ALERT_WINDOW权限<br />
&nbsp;&nbsp;&nbsp;&nbsp;并且记得申明我们自定义的application哦。<br />
AndroidManifest.xml代码如下：</p>
<pre class="wp-code-highlight prettyprint linenums:1">
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;com.krislq.floating&quot;
    android:versionCode=&quot;1&quot;
    android:versionName=&quot;1.0&quot; &gt;

    &lt;uses-sdk
        android:minSdkVersion=&quot;8&quot;
        android:targetSdkVersion=&quot;15&quot; /&gt;
	&lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot; /&gt;
    &lt;application
        android:icon=&quot;@drawable/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:theme=&quot;@style/AppTheme&quot; android:name=&quot;FloatApplication&quot;&gt;
        &lt;activity
            android:name=&quot;.MainActivity&quot;
            android:label=&quot;@string/title_activity_main&quot; &gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;
&lt;/manifest&gt;</pre>
<p>&nbsp;&nbsp;&nbsp;&nbsp;好了，就是这么简单，收工。<br />
&nbsp;&nbsp;&nbsp;&nbsp;下面为demo的下载<br />
===================<br />
<a href="http://www.krislq.com/wp-content/uploads/2012/11/FloatingWindows.rar">===FloatingWindows===</a><br />
==================
<div style="border:1px solid #d9e9f1;background:#7fbddd;font:12px 微软雅黑;margin:10px 1px">
<div style="text-align: center;border:1px solid #fff;background:#f7f7f7;padding:10px;line-height:100%">
            <img style="border-width: 0;" src="http://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" alt="知识共享许可协议" /><br />
            <br />
            本作品采用<a href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/" target="_blank">知识共享署名-非商业性使用-相同方式共享 2.5 中国大陆许可协议</a>进行许可。<br />
            <br />
            本文地址：<a href="http://www.krislq.com/2012/11/android_class_floating_window/" target="_blank">【Android课堂】在桌面添加可拖动/可点击的悬浮窗口</a>
	</div>
</div>
<div style="clear:both; margin-top:5px; margin-bottom:5px;"></div><div style="float:left"><!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_renren"></a>
	<a class="jiathis_button_kaixin001"></a>
	<a class="jiathis_button_douban"></a>
	<a class="jiathis_button_twitter"></a>
	<a class="jiathis_button_googleplus"></a>
	<a class="jiathis_button_fb"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a><br/>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1345040026876266" charset="utf-8"></script>
<br/>
<!-- JiaThis Button END --></div><div style="clear:both; margin-top:5px; margin-bottom:5px;"></div>							</div>
		</div>
		<div id="single-nav" class="navigation">
			<a href="http://www.krislq.com/2012/11/android_class_judge_whether_it_is_launcher/" rel="prev">上一篇</a>  / 			<a href="http://www.krislq.com/2012/11/android_class_floating_window2/" rel="next">下一篇</a>		</div>
        <!--
		<div id="ckepop">
			<span class="jiathis_txt">分享到：</span>
			<a class="jiathis_button_qzone">QQ空间</a>
			<a class="jiathis_button_tsina">新浪微博</a>
			<a class="jiathis_button_tqq">腾讯微博</a>
			<a class="jiathis_button_renren">人人网</a>
			<a class="jiathis_button_tsohu">搜狐微博</a>
			<a class="jiathis_button_kaixin001">开心网</a>
			<a class="jiathis_button_hi">百度空间</a>
			<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
		</div>
        -->
		<div class="a-d-s">
			<script type="text/javascript"><!--
google_ad_client = "ca-pub-1090617504732848";
/* 文章页面_728x90 */
google_ad_slot = "9856694929";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>		</div>
				<a name="comments"></a>

<div class="ds-thread" data-thread-key="325" data-author-key="1" data-title="【Android课堂】在桌面添加可拖动/可点击的悬浮窗口" data-url="http://www.krislq.com/2012/11/android_class_floating_window/"></div>

<script type="text/javascript">
	if (typeof DUOSHUO !== 'undefined')
		DUOSHUO.EmbedThread('.ds-thread');
</script>
	<div id="ds-ssr">

		
            <ol id="commentlist">
                		<li class="post pingback">
			<p>Pingback: <a href='http://igames.co/profile/flkio' rel='external nofollow' class='url'>pay day loan</a></p>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-363">
			<article id="comment-363" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://t.qq.com/zheng_jinang' rel='external nofollow' class='url'>郑锦昂</a></span> on <a rel="nofollow" href="http://www.krislq.com/2012/11/android_class_floating_window/#comment-363"><time pubdate datetime="2014-02-21T16:08:15+00:00">2014 年 2 月 21 日 at 下午 4:08</time></a> <span class="says">said:</span>					</cite><!-- .comment-author .vcard -->
				</footer>
	
				<div class="comment-content"><p>例子做的挺粗糙点 参考一下还不错</p>
</div>
				
			</article><!-- #comment-## -->
		</li><!-- #comment-## -->
		<li class="post pingback">
			<p>Pingback: <a href='http://www.krislq.com/2012/11/android_class_floating_window2/' rel='external nofollow' class='url'>Android课堂-在桌面添加可拖动/可点击的悬浮窗口(续) | Kris on Mobile Development</a></p>
		</li><!-- #comment-## -->
            </ol>

		            
    </div>	</div>
	<div id="sidebar" role="complementary">
		<ul>
<li id="text-5" class="widget widget_text"><h4 class="widget-title">订阅到邮箱</h4>			<div class="textwidget"><!--QQ邮件列表订阅嵌入代码-->
<script >
var nId = "205f350c2f37dc6a25c944414f0cca4876028fc579750f49",nWidth="auto",sColor="light",sText="欢迎订阅，精彩无限：" ;;
</script>
<script src="http://list.qq.com/zh_CN/htmledition/js/qf/page/qfcode.js" charset="gb18030"></script></div>
		</li>
<li id="text-2" class="widget widget_text"><h4 class="widget-title">关于Kris</h4>			<div class="textwidget"><div style="padding:5px">
<b><font color='red'>+</font></b> IT人，eoe超级版主，eoe成都同城会负责人。<br />
<b><font color='red'>+</font></b> 典型狮子男，阳光，随心，自信。<br />
<b><font color='red'>+</font></b> 常年活跃并蜗居于eoe社区各个角落，带领并负责开发eoe wiki客户端，参与编写《Google Android开发入门与实战》第二版。<br />
<b><font color='red'>+</font></b> 线下主要从事移动应用研发，并往Android底层探索着 ...<br />
<b><font color='red'>+</font></b> 脚踏移动互联浪潮而来，未曾有改变世界的豪迈，但求能在移动互联扎根发芽。
</div>
</div>
		</li>
<li id="text-4" class="widget widget_text"><h4 class="widget-title">Kris微信</h4>			<div class="textwidget"><div style="text-align:center">
<img border ="0" src="http://www.krislq.com/images/kris_qrcode.jpg" width="210px" alt="Kris 微信账号" title="Kris 微信账号">
扫描二维码加"krislq"微信为好友。
</div></div>
		</li>
<li id="text-3" class="widget widget_text"><h4 class="widget-title">新浪微博</h4>			<div class="textwidget"><iframe id="sina_widget_1054394381" style="width:100%; height:400px;" frameborder="0" scrolling="no" src="http://v.t.sina.com.cn/widget/widget_blog.php?uid=1054394381&height=400&skin=wd_02&showpic=1"></iframe></div>
		</li>
<li id="categories-3" class="widget widget_categories"><h4 class="widget-title">文章分类</h4>		<ul>
	<li class="cat-item cat-item-80"><a href="http://www.krislq.com/category/development/android/" >Android</a>
</li>
	<li class="cat-item cat-item-60"><a href="http://www.krislq.com/category/development/java/" title="关于j2ee, j2se, j2me的开发经验">Java</a>
</li>
	<li class="cat-item cat-item-137"><a href="http://www.krislq.com/category/development/python/" >Python</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://www.krislq.com/category/book/" title="我看过的，或者是推荐的书籍">书籍</a>
</li>
	<li class="cat-item cat-item-192"><a href="http://www.krislq.com/category/development/class/" >学习课堂</a>
</li>
	<li class="cat-item cat-item-7"><a href="http://www.krislq.com/category/toolkit/" title="一些好的工具">工具</a>
</li>
	<li class="cat-item cat-item-59"><a href="http://www.krislq.com/category/development/" >开发</a>
</li>
	<li class="cat-item cat-item-18"><a href="http://www.krislq.com/category/social/" title="关于一些社交的记录">社交</a>
</li>
	<li class="cat-item cat-item-193"><a href="http://www.krislq.com/category/development/sulotion/" >解决方案</a>
</li>
	<li class="cat-item cat-item-125"><a href="http://www.krislq.com/category/%e8%b5%84%e8%ae%af/" >资讯</a>
</li>
	<li class="cat-item cat-item-188"><a href="http://www.krislq.com/category/development/case/" >随手实例</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://www.krislq.com/category/uncategorized/" title="随手笔记，无分类杂记">随记</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://www.krislq.com/category/project/" title="开发过的项目，项目总结">项目</a>
</li>
		</ul>
</li>
		<li id="recent-posts-2" class="widget widget_recent_entries">		<h4 class="widget-title">近期文章</h4>		<ul>
					<li>
				<a href="http://www.krislq.com/2014/07/pm_10_ask/">产品经理十问</a>
						</li>
					<li>
				<a href="http://www.krislq.com/2014/07/mac-x-yosemide10-10-update-jdk-7-jdk-8/">mac x Yosemide（10.10） 下安装 jdk 1.7 (jdk 1.8)</a>
						</li>
					<li>
				<a href="http://www.krislq.com/2014/04/sreen_on_off/">监听屏幕开、关及用户解锁屏幕</a>
						</li>
					<li>
				<a href="http://www.krislq.com/2014/02/voicecloud_local/">如何通过讯飞语音将文本合成后的语音保存到本地</a>
						</li>
					<li>
				<a href="http://www.krislq.com/2013/10/%e4%b8%ba%e4%bd%95%e7%a8%8b%e5%ba%8f%e5%91%98%e5%ae%8c%e6%88%90%e6%9c%80%e5%90%8e20%e7%9a%84%e5%b7%a5%e4%bd%9c%e9%9c%80%e8%a6%81%e7%9a%84%e6%97%b6%e9%97%b4%e8%b7%9f%e4%b9%8b%e5%89%8d%e7%9a%8480/">为何程序员完成最后20%的工作需要的时间跟之前的80%一样多？</a>
						</li>
				</ul>
		</li>
<li id="recent-comments-2" class="widget widget_recent_comments"><h4 class="widget-title">近期评论</h4><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link"><a href='http://dev.lasates.com/nine-things-you-have-common-car-title-loans-los-angeles' rel='external nofollow' class='url'>http://dev.lasates.com/nine-things-you-have-common-car-title-loans-los-angeles</a></span>发表在《<a href="http://www.krislq.com/2012/11/android_class_intent_match/#comment-472">Android课堂-Intent匹配，你知多少？</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href='http://igames.co/profile/flkio' rel='external nofollow' class='url'>online payday loans bc</a></span>发表在《<a href="http://www.krislq.com/2012/12/eoe_class_floating_windows_demo/#comment-471">【在线课堂】Android悬浮窗设计 资料下载</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href='http://igames.co/profile/flkio' rel='external nofollow' class='url'>payday advance</a></span>发表在《<a href="http://www.krislq.com/2013/10/%e4%b8%ba%e4%bd%95%e7%a8%8b%e5%ba%8f%e5%91%98%e5%ae%8c%e6%88%90%e6%9c%80%e5%90%8e20%e7%9a%84%e5%b7%a5%e4%bd%9c%e9%9c%80%e8%a6%81%e7%9a%84%e6%97%b6%e9%97%b4%e8%b7%9f%e4%b9%8b%e5%89%8d%e7%9a%8480/#comment-470">为何程序员完成最后20%的工作需要的时间跟之前的80%一样多？</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href='http://igames.co/profile/flkio' rel='external nofollow' class='url'>payday loans online</a></span>发表在《<a href="http://www.krislq.com/2013/04/eclipse_settings/#comment-469">eclipse常用的设置[持续更新]</a>》</li><li class="recentcomments"><span class="comment-author-link"><a href='http://igames.co/profile/flkio' rel='external nofollow' class='url'>quick loans</a></span>发表在《<a href="http://www.krislq.com/2013/05/android-stuido/#comment-468">Android Stuido 使用之初体验</a>》</li></ul></li>
<li id="linkcat-2" class="widget widget_links"><h4 class="widget-title">友情连接</h4>
	<ul class='xoxo blogroll'>
<li><a href="http://www.niuble.com/" rel="friend met co-worker colleague" title="eric的博客" target="_blank">Eric 牛逼了</a></li>
<li><a href="http://www.fancycedar.info/" rel="acquaintance met co-worker colleague" title="fancy的博客" target="_blank">Fancy 墨迹</a></li>
<li><a href="http://www.iceskysl.com/" title="eoe CTO ice的博客" target="_blank">Iceskysl</a></li>
<li><a href="http://www.javezh.com/" rel="colleague" target="_blank">JaveZh</a></li>
<li><a href="http://love.krislq.com" rel="acquaintance met co-worker colleague co-resident spouse date sweetheart" target="_blank">Kris&amp;Seattle</a></li>
<li><a href="http://weibo.com/kris008">Kris的新浪博客</a></li>
<li><a href="http://t.qq.com/kris1987">Kris的腾讯微博</a></li>
<li><a href="http://lj00.yo2.cn/" rel="friend colleague" title="eoe创始人李杰博客" target="_blank">leex的博客</a></li>
<li><a href="http://andpue.com/" title="marks blog">Mark`s blog</a></li>
<li><a href="http://www.4wei.cn/" title="eoe 项目经理尘缘的博客" target="_blank">尘缘</a></li>
<li><a href="http://www.xukailun.me" title="贼寇的博客" target="_blank">贼寇在何方</a></li>

	</ul>
</li>

<li id="meta-4" class="widget widget_meta"><h4 class="widget-title">功能</h4>			<ul>
			<li><a href="http://www.krislq.com/wp-login.php?action=register">注册</a></li>			<li><a href="http://www.krislq.com/wp-login.php">登录</a></li>
			<li><a href="http://www.krislq.com/feed/">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://www.krislq.com/comments/feed/">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
</li>
		</ul>
	</div>	<!--WP Code Highlight_start-->
	<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	<script type="text/javascript" src="http://www.krislq.com/wp-content/plugins/wp-code-highlight/js/wp-code-highlight.js"></script>
	<!--WP Code Highlight_end-->
	<div class="clear"></div>
</div>

<div id="footer" role="contentinfo">
	<div id="colophon">
		<div class="left">&copy 2014 <a href="http://www.krislq.com/" rel="home">Kris on Mobile Development</a> | Powered by <a href="http://wordpress.org/" target="_blank" rel="generator">WordPress</a> | Designed by <a href="http://c7sky.com/" target="_blank">Cople</a> | <script src="http://s95.cnzz.com/stat.php?id=4755794&web_id=4755794&show=pic" language="JavaScript"></script>
<!-- baidu-->
<div style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F549ec241b084b9df6f141900f5fe3f23' type='text/javascript'%3E%3C/script%3E"));
</script>
</div></div>
		<div class="right"><a id="gotop" href="#top">&uarr; 返回顶部</a></div>
	</div>
</div>
<script src="http://www.krislq.com/wp-content/themes/Zine/js/ready.js"></script>
<!--[if lte IE 7]><script src="http://www.krislq.com/wp-content/themes/Zine/js/ie6upgrade.js"></script><![endif]-->
<script type="text/javascript" src="http://v2.jiathis.com/code/jia.js?uid=897472" charset="utf-8"></script><div id="wp-auto-top"><div id="wp-auto-top-top"></div><div id="wp-auto-top-comment"></div><div id="wp-auto-top-bottom"></div></div>
<script> var commentPositionId = '[name="comments"]:last';var wpAutoTopSpeed = 1;</script><style>
   #wp-auto-top{position:fixed;top:45%;right:50%;display:block;margin-right:-540px; z-index:9999;}
   #wp-auto-top-top,#wp-auto-top-comment,#wp-auto-top-bottom{background:url(http://www.krislq.com/wp-content/plugins/wp-auto-top/img/18.png) no-repeat;position:relative;cursor:pointer;height:25px;width:29px;margin:10px 0 0;}
   #wp-auto-top-comment{background-position:left -30px;height:32px;}#wp-auto-top-bottom{background-position:left -68px;}
   #wp-auto-top-comment:hover{background-position:right -30px;}
   #wp-auto-top-top:hover{background-position:right 0;}
   #wp-auto-top-bottom:hover{background-position:right -68px ;}
   </style><script type='text/javascript' src='http://www.krislq.com/wp-content/plugins/wp-auto-top/wp-auto-top.js?ver=4.0'></script>
</body>
</html>
<!-- Dynamic page generated in 0.302 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2014-10-16 15:20:36 -->
